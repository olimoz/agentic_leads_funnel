2024-12-12 13:50:47,338 - app - INFO - Checking pricing for model: llama-3.1-sonar-small-128k-online
2024-12-12 13:50:47,341 - app - INFO - Checking pricing for model: gpt-4o-mini-2024-07-18
2024-12-12 13:50:47,343 - app - INFO - Checking pricing for model: tavily
2024-12-12 13:50:47,345 - app - INFO - Checking pricing for model: gpt-4o-2024-05-13
2024-12-12 13:50:47,348 - app - INFO - Checking pricing for model: gpt-4o-2024-08-06
2024-12-12 13:50:47,350 - app - INFO - Checking pricing for model: gpt-4o
2024-12-12 13:50:47,352 - app - INFO - Checking pricing for model: get_email_candidates
2024-12-12 13:50:47,352 - app - INFO - Pricing sequentiality check completed.
2024-12-12 13:50:47,387 - app - INFO - Loaded config for client: ThinkVideo
2024-12-12 13:50:47,515 - app - INFO - Created 1 client tasks
2024-12-12 13:50:47,544 - app - ERROR - The following models are present in consumption data but missing from pricing data: None
2024-12-12 13:50:51,238 - app - INFO - Batch cost saved to ThinkVideo_20241201_20241212.xlsx
2024-12-12 13:50:51,239 - app - INFO - Total cost for the period: $0.98
2024-12-12 13:50:51,239 - app - INFO - Configuring pipeline for: ThinkVideo 
2024-12-12 13:50:55,170 - app - INFO - Loaded df_search_tasks for: ThinkVideo 
2024-12-12 13:50:55,225 - app - INFO - DataFrame loaded from df_search_history.parquet
2024-12-12 13:50:55,226 - app - INFO - Loaded df_search_history for: ThinkVideo. Length: 620 records
2024-12-12 13:50:57,319 - app - INFO - There are 7971 valid candidates for search.
2024-12-12 13:50:57,352 - app - INFO - As instructed, this batch will process 6.
2024-12-12 13:50:57,353 - app - INFO - Processing mini batch starting at index 0. Batch Size: 6. Mini Batch Size: 2
2024-12-12 13:50:57,354 - app - INFO - - Processing: Rob Slater, Marble Media
2024-12-12 13:50:57,425 - app - INFO - - Processing: Louise Squires, Louise Squires Clinical Hypnotherapist
2024-12-12 13:51:01,438 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:01,584 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:06,261 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:07,016 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:11,719 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:12,096 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:18,695 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:19,257 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:24,340 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:24,625 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:34,372 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:34,399 - app - ERROR - Error processing mini batch starting at index 0:
Error type: RetryError
Error message: RetryError[<Future at 0x7a5c7813e800 state=finished raised TypeError>]
Traceback:
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/asyncio/__init__.py", line 114, in __call__
    result = await fn(*args, **kwargs)
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 65, in run
    await self.app.handle_error(self.app.logger, logging.ERROR, msg)
TypeError: object NoneType can't be used in 'await' expression

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/core/client_manager.py", line 244, in process_client
    results = await asyncio.gather(*tasks)
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/core/candidate_pipeline.py", line 73, in process
    search_event_type, consumption = await self.get_search_event_type(candidate, search_limiter_perplexity)
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/core/candidate_pipeline.py", line 139, in get_search_event_type
    return await self.perplexity_agent.run(query)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/asyncio/__init__.py", line 189, in async_wrapped
    return await copy(fn, *args, **kwargs)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/asyncio/__init__.py", line 111, in __call__
    do = await self.iter(retry_state=retry_state)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/asyncio/__init__.py", line 153, in iter
    result = await action(retry_state)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/_utils.py", line 99, in inner
    return call(*args, **kwargs)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/__init__.py", line 419, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7a5c7813e800 state=finished raised TypeError>]

2024-12-12 13:51:34,400 - app - INFO - Processing mini batch starting at index 2. Batch Size: 6. Mini Batch Size: 2
2024-12-12 13:51:34,400 - app - INFO - - Processing: Jessika Thiele, Geronimo
2024-12-12 13:51:34,432 - app - INFO - - Processing: Ben Massey, The National Association of Jewellers
2024-12-12 13:51:37,751 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:38,367 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:41,746 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:42,975 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:43,317 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:46,354 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:48,500 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:51,602 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:55,573 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:55,589 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:59,871 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:51:59,901 - app - ERROR - Error processing mini batch starting at index 2:
Error type: RetryError
Error message: RetryError[<Future at 0x7a5c78002c50 state=finished raised TypeError>]
Traceback:
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/asyncio/__init__.py", line 114, in __call__
    result = await fn(*args, **kwargs)
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 65, in run
    await self.app.handle_error(self.app.logger, logging.ERROR, msg)
TypeError: object NoneType can't be used in 'await' expression

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/core/client_manager.py", line 244, in process_client
    results = await asyncio.gather(*tasks)
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/core/candidate_pipeline.py", line 73, in process
    search_event_type, consumption = await self.get_search_event_type(candidate, search_limiter_perplexity)
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/core/candidate_pipeline.py", line 139, in get_search_event_type
    return await self.perplexity_agent.run(query)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/asyncio/__init__.py", line 189, in async_wrapped
    return await copy(fn, *args, **kwargs)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/asyncio/__init__.py", line 111, in __call__
    do = await self.iter(retry_state=retry_state)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/asyncio/__init__.py", line 153, in iter
    result = await action(retry_state)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/_utils.py", line 99, in inner
    return call(*args, **kwargs)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/__init__.py", line 419, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7a5c78002c50 state=finished raised TypeError>]

2024-12-12 13:51:59,901 - app - INFO - Processing mini batch starting at index 4. Batch Size: 6. Mini Batch Size: 2
2024-12-12 13:51:59,902 - app - INFO - - Processing: Jolene Maloney, Croda
2024-12-12 13:51:59,946 - app - INFO - - Processing: ABBY RASHMAN, The Croft Farm Escape
2024-12-12 13:52:00,160 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:52:04,170 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:52:04,584 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:52:07,855 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:52:08,407 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:52:13,301 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:52:13,321 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:52:16,140 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:52:16,765 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:52:20,453 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:52:25,671 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:52:29,975 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:52:33,594 - app - ERROR - Error occurred in function 'run' in file '/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py' at line 65
Error message: 40
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'
2024-12-12 13:52:33,611 - app - ERROR - Error processing mini batch starting at index 4:
Error type: RetryError
Error message: RetryError[<Future at 0x7a5c781cc040 state=finished raised TypeError>]
Traceback:
Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 38, in run
    print(f"Perp citations: {response.model_extra.get('citations')}")
AttributeError: 'AIMessage' object has no attribute 'model_extra'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/asyncio/__init__.py", line 114, in __call__
    result = await fn(*args, **kwargs)
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/agents/perplexity_agent.py", line 65, in run
    await self.app.handle_error(self.app.logger, logging.ERROR, msg)
TypeError: object NoneType can't be used in 'await' expression

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/core/client_manager.py", line 244, in process_client
    results = await asyncio.gather(*tasks)
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/core/candidate_pipeline.py", line 73, in process
    search_event_type, consumption = await self.get_search_event_type(candidate, search_limiter_perplexity)
  File "/home/oliver/MindSearch/mindsearch/agent/agent_candidate_search/core/candidate_pipeline.py", line 139, in get_search_event_type
    return await self.perplexity_agent.run(query)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/asyncio/__init__.py", line 189, in async_wrapped
    return await copy(fn, *args, **kwargs)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/asyncio/__init__.py", line 111, in __call__
    do = await self.iter(retry_state=retry_state)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/asyncio/__init__.py", line 153, in iter
    result = await action(retry_state)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/_utils.py", line 99, in inner
    return call(*args, **kwargs)
  File "/home/oliver/anaconda3/envs/langgraph/lib/python3.10/site-packages/tenacity/__init__.py", line 419, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7a5c781cc040 state=finished raised TypeError>]

2024-12-12 13:52:33,612 - app - INFO - Saved batch search results to : df_search_history.parquet
2024-12-12 13:52:33,612 - app - INFO - Start email processing...
2024-12-12 13:52:33,612 - app - INFO - No emails sent. Today is Thursday, which is not a designated day: ['Wednesday', 'Friday'] for ThinkVideo
2024-12-12 13:52:33,612 - app - INFO - Processing complete for : ThinkVideo
2024-12-12 13:52:33,621 - app - ERROR - The following models are present in consumption data but missing from pricing data: None
